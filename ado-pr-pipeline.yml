# trigger:
# - master

pr:
- master

pool:
  vmImage: ubuntu-latest

variables:
  BuildConfiguration: "Release"

stages:
- stage: CI_PullRequest
  displayName: Pull Request(CI)
  jobs:
  - job: BuildJob
    displayName: Build Job

    steps:
    - task: UseDotNet@2
      displayName: Use .Net 6.x
      inputs:
        packageType: 'sdk'
        version: '6.x'

    - task: DotNetCoreCLI@2
      displayName: 'DotNet Restore Before Build'
      inputs:
        command: 'restore'
        projects: '**/DemoAPI/*.csproj'

    - task: DotNetCoreCLI@2
      displayName: "Build with $(buildConfiguration) configuration"
      inputs:
        command: 'build'
        arguments: '--no-restore'
        projects: '**/DemoAPI/*.csproj'

  - job: TestJob
    displayName: Test Job
    dependsOn: BuildJob
    #condition: succeeded('build_job')
    steps:
    - task: UseDotNet@2
      displayName: Use .Net 6.x
      inputs:
        packageType: 'sdk'
        version: '6.x'

    - task: DotNetCoreCLI@2
      displayName: 'DotNet Restore Before Unit Test'
      inputs:
        command: 'restore'
        projects: '**/DemoAPI.Test/*.csproj'

    - task: DotNetCoreCLI@2
      displayName: 'Unit Test'
      inputs:
        command: 'test'
        arguments: '--no-restore'
        projects: '**/DemoAPI.Test/*.csproj'
        publishTestResults: true